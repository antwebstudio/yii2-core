!function(t){function e(t){var e=t.currentTarget;"undefined"!=typeof e.__resizeTrigger__&&(e.__resizeRAF__&&Helper.cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=Helper.requestAnimationFrame(function(){("undefined"==typeof e.__lastOffsetWidth__||e.__resizeTrigger__.prop("offsetWidth")!=e.__lastOffsetWidth__||e.__resizeTrigger__.prop("offsetHeight")!=e.__lastOffsetHeight__)&&(e.__lastOffsetWidth__=e.__resizeTrigger__.prop("offsetWidth"),e.__lastOffsetHeight__=e.__resizeTrigger__.prop("offsetHeight"),e.__resizeTrigger__.trigger("resize"))}))}function i(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.__lastOffsetWidth__=this.__resizeElement__.data("initialWidth"),this.contentDocument.defaultView.__lastOffsetHeight__=this.__resizeElement__.data("initialHeight"),this.__resizeElement__.removeData("initialWidth"),this.__resizeElement__.removeData("initialHeight"),t(this.contentDocument.defaultView).on("resize",e).trigger("resize")}var s=function(){};if(s.extend=function(t,e){var i=s.prototype.extend;s._prototyping=!0;var n=new this;i.call(n,t),n.base=function(){},delete s._prototyping;var r=n.constructor,o=n.constructor=function(){if(!s._prototyping)if(this._constructing||this.constructor==o)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||i).call(arguments[0],n)};return o.ancestor=this,o.extend=this.extend,o.forEach=this.forEach,o.implement=this.implement,o.prototype=n,o.toString=this.toString,o.valueOf=function(t){return"object"==t?o:r.valueOf()},i.call(o,e),"function"==typeof o.init&&o.init(),o},s.prototype={extend:function(t,e){if(arguments.length>1){var i=this[t];if(i&&"function"==typeof e&&(!i.valueOf||i.valueOf()!=e.valueOf())&&/\bbase\b/.test(e)){var n=e.valueOf();e=function(){var t=this.base||s.prototype.base;this.base=i;var e=n.apply(this,arguments);return this.base=t,e},e.valueOf=function(t){return"object"==t?e:n},e.toString=s.toString}this[t]=e}else if(t){var r=s.prototype.extend;s._prototyping||"function"==typeof this||(r=this.extend||r);for(var o={toSource:null},h=["constructor","toString","valueOf"],a=s._prototyping?0:1;l=h[a++];)t[l]!=o[l]&&r.call(this,l,t[l]);for(var l in t)if(!o[l]){var g=Object.getOwnPropertyDescriptor(t,l);"undefined"!=typeof g.value?r.call(this,l,g.value):Object.defineProperty(this,l,g)}}return this}},s=s.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(t,e,i){for(var s in t)void 0===this.prototype[s]&&e.call(i,t[s],s,t)},implement:function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?arguments[t](this.prototype):this.prototype.extend(arguments[t]);return this},toString:function(){return String(this.valueOf())}}),"undefined"!=typeof Helper)throw"Helper is already defined!";Helper={$win:t(window),$doc:t(document),$bod:t(document.body)},Helper.rtl=Helper.$bod.hasClass("rtl"),Helper.ltr=!Helper.rtl,Helper=t.extend(Helper,{RETURN_KEY:13,PRIMARY_CLICK:1,SECONDARY_CLICK:3,X_AXIS:"x",Y_AXIS:"y",FX_DURATION:100,TEXT_NODE:3,log:function(t){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(t)},_isMobileBrowser:null,_isMobileOrTabletBrowser:null,isMobileBrowser:function(t){var e=t?"_isMobileOrTabletBrowser":"_isMobileBrowser";if(null===Helper[e]){var i=navigator.userAgent||navigator.vendor||window.opera;Helper[e]=new RegExp("(android|bbd+|meego).+mobile|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|wap|windows ce|xda|xiino"+(t?"|android|ipad|playbook|silk":""),"i").test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}return Helper[e]},isArray:function(t){return t instanceof Array},isJquery:function(t){return t instanceof jQuery},isString:function(t){return"string"==typeof t},hasAttr:function(e,i){var s=t(e).attr(i);return"undefined"!=typeof s&&s!==!1},isTextNode:function(t){return t.nodeType==Helper.TEXT_NODE},getDist:function(t,e,i,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))},hitTest:function(e,i,s){return Helper.hitTest._$elem=t(s),Helper.hitTest._offset=Helper.hitTest._$elem.offset(),Helper.hitTest._x1=Helper.hitTest._offset.left,Helper.hitTest._y1=Helper.hitTest._offset.top,Helper.hitTest._x2=Helper.hitTest._x1+Helper.hitTest._$elem.outerWidth(),Helper.hitTest._y2=Helper.hitTest._y1+Helper.hitTest._$elem.outerHeight(),e>=Helper.hitTest._x1&&e<Helper.hitTest._x2&&i>=Helper.hitTest._y1&&i<Helper.hitTest._y2},isCursorOver:function(t,e){return Helper.hitTest(t.pageX,t.pageY,e)},copyTextStyles:function(e,i){var s=t(e),n=t(i);n.css({fontFamily:s.css("fontFamily"),fontSize:s.css("fontSize"),fontWeight:s.css("fontWeight"),letterSpacing:s.css("letterSpacing"),lineHeight:s.css("lineHeight"),textAlign:s.css("textAlign"),textIndent:s.css("textIndent"),whiteSpace:s.css("whiteSpace"),wordSpacing:s.css("wordSpacing"),wordWrap:s.css("wordWrap")})},getBodyScrollTop:function(){return Helper.getBodyScrollTop._scrollTop=document.body.scrollTop,Helper.getBodyScrollTop._scrollTop<0?Helper.getBodyScrollTop._scrollTop=0:(Helper.getBodyScrollTop._maxScrollTop=Helper.$bod.outerHeight()-Helper.$win.height(),Helper.getBodyScrollTop._scrollTop>Helper.getBodyScrollTop._maxScrollTop&&(Helper.getBodyScrollTop._scrollTop=Helper.getBodyScrollTop._maxScrollTop)),Helper.getBodyScrollTop._scrollTop},requestAnimationFrame:function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)};return function(e){return t(e)}}(),cancelAnimationFrame:function(){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(e){return t(e)}}(),scrollContainerToElement:function(e,i){var s=t(e),n=t(i),r=s.scrollTop(),o=n.offset().top;if(s[0]==window)var h=o-r;else var h=o-s.offset().top;if(0>h)s.scrollTop(r+h);else{var a=n.outerHeight(),l=s[0]==window?window.innerHeight:s[0].clientHeight;h+a>l&&s.scrollTop(r+(h-(l-a)))}},SHAKE_STEPS:10,SHAKE_STEP_DURATION:25,shake:function(e,i){var s=t(e);i||(i="margin-left");var n=parseInt(s.css(i));isNaN(n)&&(n=0);for(var r=0;r<=Helper.SHAKE_STEPS;r++)!function(t){setTimeout(function(){Helper.shake._properties={},Helper.shake._properties[i]=n+(t%2?-1:1)*(10-t),s.velocity(Helper.shake._properties,Helper.SHAKE_STEP_DURATION)},Helper.SHAKE_STEP_DURATION*t)}(r)},getElement:function(e){return t.makeArray(e)[0]},getInputBasename:function(e){var i=t(e).attr("name");return i?i.replace(/\[.*/,""):null},getInputPostVal:function(t){var e=t.attr("type"),i=t.val();return"checkbox"==e||"radio"==e?t.prop("checked")?i:null:Helper.isArray(i)&&"[]"!=t.attr("name").substr(-2)?i.length?i[i.length-1]:null:i},findInputs:function(e){return t(e).find("input,text,textarea,select,button")},getPostData:function(t){for(var e={},i={},s=Helper.findInputs(t),n=0;n<s.length;n++){var r=s.eq(n);if(!r.prop("disabled")){var o=r.attr("name");if(o){var h=Helper.getInputPostVal(r);if(null!==h){var a="[]"==o.substr(-2);if(a){var l=o.substring(0,o.length-2);"undefined"==typeof i[l]&&(i[l]=0)}Helper.isArray(h)||(h=[h]);for(var g=0;g<h.length;g++){if(a){var o=l+"["+i[l]+"]";i[l]++}e[o]=h[g]}}}}}return e},copyInputValues:function(t,e){for(var i=Helper.findInputs(t),s=Helper.findInputs(e),n=0;n<i.length&&"undefined"!=typeof s[n];n++)s.eq(n).val(i.eq(n).val())}}),Helper.Base=s.extend({settings:null,_eventHandlers:null,_namespace:null,_$listeners:null,_disabled:!1,constructor:function(){this._eventHandlers=[],this._namespace=".Helper"+Math.floor(1e9*Math.random()),this._listeners=[],this.init.apply(this,arguments)},init:t.noop,setSettings:function(e,i){var s="undefined"==typeof this.settings?{}:this.settings;this.settings=t.extend({},s,i,e)},on:function(t,e,i){"function"==typeof e&&(i=e,e={});for(var t=this._normalizeEvents(t),s=0;s<t.length;s++){var n=t[s];this._eventHandlers.push({type:n[0],namepsace:n[1],data:e,handler:i})}},off:function(t){for(var t=this._normalizeEvents(t),e=0;t>e;e++)for(var i=t[e],s=this._eventHandlers.length-1;s>=0;e--){var n=this._eventHandlers[s];n.type!=i[0]||i[1]&&n.namespace!=i[1]||this._eventHandlers.splice(s,1)}},trigger:function(e,i){var s={type:e,target:this};"undefined"==typeof params&&(params=[]);for(var n=0;n<this._eventHandlers.length;n++){var r=this._eventHandlers[n];if(r.type==e){var o=t.extend({data:r.data},i,s);r.handler(o)}}},_normalizeEvents:function(t){"string"==typeof t&&(t=t.split(" "));for(var e=0;e<t.length;e++)"string"==typeof t[e]&&(t[e]=t[e].split("."));return t},_splitEvents:function(e){if("string"==typeof e){e=e.split(",");for(var i=0;i<e.length;i++)e[i]=t.trim(e[i])}return e},_formatEvents:function(t){for(var t=this._splitEvents(t).slice(0),e=0;e<t.length;e++)t[e]+=this._namespace;return t.join(" ")},addListener:function(e,s,n,r){var o=t(e);if(o.length){if(s=this._splitEvents(s),"undefined"==typeof r&&"object"!=typeof n&&(r=n,n={}),r="function"==typeof r?t.proxy(r,this):t.proxy(this,r),o.on(this._formatEvents(s),n,t.proxy(function(){this._disabled||r.apply(this,arguments)},this)),-1==t.inArray(e,this._listeners)&&this._listeners.push(e),-1!=t.inArray("activate",s)&&!o.data("Helper-activatable")){var h=this._namespace+"-activate";o.on("mousedown"+h,function(t){t.preventDefault()}),o.on("click"+h,function(i){i.preventDefault();var s=t.inArray(i.currentTarget,o),n=t(e[s]);n.hasClass("disabled")||n.trigger("activate")}),o.on("keydown"+h,function(e){var i=t.inArray(e.currentTarget,o);if(-1!=i&&e.keyCode==Helper.SPACE_KEY){e.preventDefault();var s=o.eq(i);s.hasClass("disabled")||(s.addClass("active"),Helper.$doc.on("keyup"+h,function(t){o.removeClass("active"),t.keyCode==Helper.SPACE_KEY&&(t.preventDefault(),s.trigger("activate")),Helper.$doc.off("keyup"+h)}))}}),o.hasClass("disabled")?o.removeAttr("tabindex"):o.attr("tabindex","0"),o.data("Helper-activatable",!0)}if(-1!=t.inArray("textchange",s))for(var a=0;a<o.length;a++){var l=o.eq(a);if(l.data("Helper-textchangeValue",l.val()),!l.data("Helper-textchangeable")){var g=this._namespace+"-textchange",s="keypress"+g+" keyup"+g+" change"+g+" blur"+g;l.on(s,function(e){var i=t(e.currentTarget),s=i.val();s!=i.data("Helper-textchangeValue")&&(i.data("Helper-textchangeValue",s),i.trigger("textchange"))}),l.data("Helper-textchangeable",!0)}}if(-1!=t.inArray("resize",s))for(var a=0;a<o.length;a++)!function(e){if(e!=window&&!document.attachEvent&&!e.__resizeTrigger__){"static"==getComputedStyle(e).position&&(e.style.position="relative");var s=e.__resizeTrigger__=document.createElement("object");s.className="resize-trigger",s.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),s.__resizeElement__=t(e),s.__resizeElement__.data("initialWidth",s.__resizeElement__.prop("offsetWidth")),s.__resizeElement__.data("initialHeight",s.__resizeElement__.prop("offsetHeight")),s.onload=i,s.type="text/html",s.__resizeElement__.prepend(s),s.data="about:blank",Helper.$win.on("resize",function(){s.contentDocument&&t(s.contentDocument.defaultView).trigger("resize")}),t(s).next().addClass("first")}}(o[a])}},removeListener:function(e,i){t(e).off(this._formatEvents(i))},removeAllListeners:function(e){t(e).off(this._namespace)},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this.removeAllListeners(this._listeners)}}),Helper.BaseDrag=Helper.Base.extend({$items:null,dragging:!1,mousedownX:null,mousedownY:null,realMouseX:null,realMouseY:null,mouseX:null,mouseY:null,mouseDistX:null,mouseDistY:null,mouseOffsetX:null,mouseOffsetY:null,$targetItem:null,scrollProperty:null,scrollAxis:null,scrollDist:null,scrollProxy:null,scrollFrame:null,_:null,init:function(e,i){"undefined"==typeof i&&t.isPlainObject(e)&&(i=e,e=null),this.settings=t.extend({},Helper.BaseDrag.defaults,i),this.$items=t(),this._={},e&&this.addItems(e)},allowDragging:function(){return!0},startDragging:function(){this.dragging=!0,this.onDragStart()},drag:function(e){e&&(this.drag._scrollProperty=null,this.settings.axis!=Helper.X_AXIS&&(this.drag._winScrollTop=Helper.$win.scrollTop(),this.drag._minMouseScrollY=this.drag._winScrollTop+Helper.BaseDrag.windowScrollTargetSize,this.mouseY<this.drag._minMouseScrollY?(this.drag._scrollProperty="scrollTop",this.drag._scrollAxis="Y",this.drag._scrollDist=Math.round((this.mouseY-this.drag._minMouseScrollY)/2)):(this.drag._maxMouseScrollY=this.drag._winScrollTop+Helper.$win.height()-Helper.BaseDrag.windowScrollTargetSize,this.mouseY>this.drag._maxMouseScrollY&&(this.drag._scrollProperty="scrollTop",this.drag._scrollAxis="Y",this.drag._scrollDist=Math.round((this.mouseY-this.drag._maxMouseScrollY)/2)))),this.drag._scrollProperty||this.settings.axis==Helper.Y_AXIS||(this.drag._winScrollLeft=Helper.$win.scrollLeft(),this.drag._minMouseScrollX=this.drag._winScrollLeft+Helper.BaseDrag.windowScrollTargetSize,this.mouseX<this.drag._minMouseScrollX?(this.drag._scrollProperty="scrollLeft",this.drag._scrollAxis="X",this.drag._scrollDist=Math.round((this.mouseX-this.drag._minMouseScrollX)/2)):(this.drag._maxMouseScrollX=this.drag._winScrollLeft+Helper.$win.width()-Helper.BaseDrag.windowScrollTargetSize,this.mouseX>this.drag._maxMouseScrollX&&(this.drag._scrollProperty="scrollLeft",this.drag._scrollAxis="X",this.drag._scrollDist=Math.round((this.mouseX-this.drag._maxMouseScrollX)/2)))),this.drag._scrollProperty?(this.scrollProperty||(this.scrollProxy||(this.scrollProxy=t.proxy(this,"_scrollWindow")),this.scrollFrame&&(Helper.cancelAnimationFrame(this.scrollFrame),this.scrollFrame=null),this.scrollFrame=Helper.requestAnimationFrame(this.scrollProxy)),this.scrollProperty=this.drag._scrollProperty,this.scrollAxis=this.drag._scrollAxis,this.scrollDist=this.drag._scrollDist):this._cancelWindowScroll()),this.onDrag()},stopDragging:function(){this.dragging=!1,this.onDragStop(),this._cancelWindowScroll()},addItems:function(e){e=t.makeArray(e);for(var i=0;i<e.length;i++){var s=e[i];t.data(s,"drag")&&(Helper.log("Element was added to more than one dragger"),t.data(s,"drag").removeItems(s)),t.data(s,"drag",this),this.addListener(s,"mousedown","_handleMouseDown")}this.$items=this.$items.add(e)},removeItems:function(e){e=t.makeArray(e);for(var i=0;i<e.length;i++){var s=e[i],n=t.inArray(s,this.$items);-1!=n&&(this._deinitItem(s),this.$items.splice(n,1))}},removeAllItems:function(){for(var e=0;e<this.$items.length;e++)this._deinitItem(this.$items[e]);this.$items=t()},destroy:function(){this.removeAllItems(),this.base()},onDragStart:function(){Helper.requestAnimationFrame(t.proxy(function(){this.trigger("dragStart"),this.settings.onDragStart()},this))},onDrag:function(){Helper.requestAnimationFrame(t.proxy(function(){this.trigger("drag"),this.settings.onDrag()},this))},onDragStop:function(){Helper.requestAnimationFrame(t.proxy(function(){this.trigger("dragStop"),this.settings.onDragStop()},this))},_handleMouseDown:function(e){if(e.which==Helper.PRIMARY_CLICK&&!this.$targetItem){var i=t(e.target),s=this._getItemHandle(e.currentTarget);if((i.is(s)||i.closest(s).length)&&(e.currentTarget==e.target||!this.settings.ignoreHandleSelector||!i.is(this.settings.ignoreHandleSelector)&&!i.closest(this.settings.ignoreHandleSelector).length)&&(e.preventDefault(),this.allowDragging())){this.$targetItem=t(e.currentTarget),this.mousedownX=this.mouseX=e.pageX,this.mousedownY=this.mouseY=e.pageY;var n=this.$targetItem.offset();this.mouseOffsetX=e.pageX-n.left,this.mouseOffsetY=e.pageY-n.top,this.addListener(Helper.$doc,"mousemove","_handleMouseMove"),this.addListener(Helper.$doc,"mouseup","_handleMouseUp")}}},_getItemHandle:function(e){if(this.settings.handle){if("object"==typeof this.settings.handle)return t(this.settings.handle);if("string"==typeof this.settings.handle)return t(this.settings.handle,e);if("function"==typeof this.settings.handle)return t(this.settings.handle(e))}return t(e)},_handleMouseMove:function(t){t.preventDefault(),this.realMouseX=t.pageX,this.realMouseY=t.pageY,this.settings.axis!=Helper.Y_AXIS&&(this.mouseX=t.pageX),this.settings.axis!=Helper.X_AXIS&&(this.mouseY=t.pageY),this.mouseDistX=this.mouseX-this.mousedownX,this.mouseDistY=this.mouseY-this.mousedownY,this.dragging||(this._handleMouseMove._mouseDist=Helper.getDist(this.mousedownX,this.mousedownY,this.realMouseX,this.realMouseY),this._handleMouseMove._mouseDist>=Helper.BaseDrag.minMouseDist&&this.startDragging()),this.dragging&&this.drag(!0)},_handleMouseUp:function(){this.removeAllListeners(Helper.$doc),this.dragging&&this.stopDragging(),this.$targetItem=null},_scrollWindow:function(){this._.scrollPos=Helper.$win[this.scrollProperty](),Helper.$win[this.scrollProperty](this._.scrollPos+this.scrollDist),this["mouse"+this.scrollAxis]-=this._.scrollPos-Helper.$win[this.scrollProperty](),this["realMouse"+this.scrollAxis]=this["mouse"+this.scrollAxis],this.drag(),this.scrollFrame=Helper.requestAnimationFrame(this.scrollProxy)},_cancelWindowScroll:function(){this.scrollFrame&&(Helper.cancelAnimationFrame(this.scrollFrame),this.scrollFrame=null),this.scrollProperty=null,this.scrollAxis=null,this.scrollDist=null},_deinitItem:function(e){this.removeAllListeners(e),t.removeData(e,"drag")}},{minMouseDist:1,windowScrollTargetSize:25,defaults:{handle:null,axis:null,ignoreHandleSelector:"input, textarea, button, select, .btn",onDragStart:t.noop,onDrag:t.noop,onDragStop:t.noop}}),Helper.CheckboxSelect=Helper.Base.extend({$container:null,$all:null,$options:null,init:function(e){this.$container=t(e),this.$container.data("checkboxSelect")&&(Helper.log("Double-instantiating a checkbox select on an element"),this.$container.data("checkbox-select").destroy()),this.$container.data("checkboxSelect",this);var i=this.$container.find("input");this.$all=i.filter(".all:first"),this.$options=i.not(this.$all),this.addListener(this.$all,"change","onAllChange")},onAllChange:function(){var t=this.$all.prop("checked");this.$options.prop({checked:t,disabled:t})},destroy:function(){this.$container.removeData("checkboxSelect"),this.base()}}),Helper.ContextMenu=Helper.Base.extend({$target:null,options:null,$menu:null,showingMenu:!1,init:function(e,i,s){this.$target=t(e),this.$target.data("contextmenu")&&(Helper.log("Double-instantiating a context menu on an element"),this.$target.data("contextmenu").destroy()),this.$target.data("contextmenu",this),this.options=i,this.setSettings(s,Helper.ContextMenu.defaults),Helper.ContextMenu.counter++,this.enable()},buildMenu:function(){this.$menu=t('<div class="'+this.settings.menuClass+'" style="display: none" />');var e=t("<ul/>").appendTo(this.$menu);for(var i in this.options){var s=this.options[i];if("-"==s)t("<hr/>").appendTo(this.$menu),e=t("<ul/>").appendTo(this.$menu);else{var n=t("<li></li>").appendTo(e),r=t("<a>"+s.label+"</a>").appendTo(n);"function"==typeof s.onClick&&function(e,i){setTimeout(t.proxy(function(){e.mousedown(t.proxy(function(e){this.hideMenu(),i.call(this.currentTarget,t.extend(e,{currentTarget:this.currentTarget}))},this))},this),1)}.call(this,r,s.onClick)}}},showMenu:function(e){("mousedown"!=e.type||e.which==Helper.SECONDARY_CLICK)&&("contextmenu"==e.type&&e.preventDefault(),this.showing&&e.currentTarget==this.currentTarget||(this.currentTarget=e.currentTarget,this.$menu||this.buildMenu(),this.$menu.appendTo(document.body),this.$menu.show(),this.$menu.css({left:e.pageX+1,top:e.pageY-4}),this.showing=!0,setTimeout(t.proxy(function(){this.addListener(Helper.$doc,"mousedown","hideMenu")},this),0)))},hideMenu:function(){this.removeListener(Helper.$doc,"mousedown"),this.$menu.hide(),this.showing=!1},enable:function(){this.addListener(this.$target,"contextmenu,mousedown","showMenu")},disable:function(){this.removeListener(this.$target,"contextmenu,mousedown")},destroy:function(){this.$target.removeData("contextmenu"),this.base()}},{defaults:{menuClass:"menu"},counter:0}),Helper.Drag=Helper.BaseDrag.extend({targetItemWidth:null,targetItemHeight:null,targetItemPositionInDraggee:null,$draggee:null,otherItems:null,totalOtherItems:null,helpers:null,helperTargets:null,helperPositions:null,helperLagIncrement:null,updateHelperPosProxy:null,updateHelperPosFrame:null,lastMouseX:null,lastMouseY:null,_returningHelpersToDraggees:!1,init:function(e,i){"undefined"==typeof i&&t.isPlainObject(e)&&(i=e,e=null),i=t.extend({},Helper.Drag.defaults,i),this.base(e,i)},allowDragging:function(){return!this._returningHelpersToDraggees},startDragging:function(){this.helpers=[],this.helperTargets=[],this.helperPositions=[],this.lastMouseX=this.lastMouseY=null,this.targetItemWidth=this.$targetItem.outerWidth(),this.targetItemHeight=this.$targetItem.outerHeight(),this.draggeeDisplay=this.$targetItem.css("display"),this.setDraggee(this.findDraggee()),this.otherItems=[];for(var e=0;e<this.$items.length;e++){var i=this.$items[e];-1==t.inArray(i,this.$draggee)&&this.otherItems.push(i)}this.totalOtherItems=this.otherItems.length,this.updateHelperPosProxy||(this.updateHelperPosProxy=t.proxy(this,"_updateHelperPos")),this.helperLagIncrement=1==this.helpers.length?0:this.settings.helperLagIncrementDividend/(this.helpers.length-1),this.updateHelperPosFrame=Helper.requestAnimationFrame(this.updateHelperPosProxy),this.base()},setDraggee:function(e){if(this.targetItemPositionInDraggee=t.inArray(this.$targetItem[0],e.add(this.$targetItem[0])),this.$draggee=t([this.$targetItem[0]].concat(e.not(this.$targetItem).toArray())),this.settings.singleHelper)this._createHelper(0);else for(var i=0;i<this.$draggee.length;i++)this._createHelper(i);this.settings.removeDraggee?this.$draggee.hide():this.settings.collapseDraggees?(this.$targetItem.css("visibility","hidden"),this.$draggee.not(this.$targetItem).hide()):this.$draggee.css("visibility","hidden")},appendDraggee:function(e){if(e.length){if(!this.settings.collapseDraggees)var i=this.$draggee.length;if(this.$draggee=t(this.$draggee.toArray().concat(e.toArray())),!this.settings.collapseDraggees)for(var s=this.$draggee.length,n=i;s>n;n++)this._createHelper(n);this.settings.removeDraggee||this.settings.collapseDraggees?e.hide():e.css("visibility","hidden")}},drag:function(t){this.draggeeVirtualMidpointX=this.mouseX-this.mouseOffsetX+this.targetItemWidth/2,this.draggeeVirtualMidpointY=this.mouseY-this.mouseOffsetY+this.targetItemHeight/2,this.base(t)},stopDragging:function(){Helper.cancelAnimationFrame(this.updateHelperPosFrame),this.base()},findDraggee:function(){switch(typeof this.settings.filter){case"function":return this.settings.filter();case"string":return this.$items.filter(this.settings.filter);default:return this.$targetItem}},getHelperTargetX:function(){return this.mouseX-this.mouseOffsetX},getHelperTargetY:function(){return this.mouseY-this.mouseOffsetY},returnHelpersToDraggees:function(){this._returningHelpersToDraggees=!0;for(var e=0;e<this.helpers.length;e++){var i=this.$draggee.eq(e),s=this.helpers[e];i.css({display:this.draggeeDisplay,visibility:"hidden"});var n=i.offset();if(0==e)var r=t.proxy(this,"_showDraggee");else var r=null;s.velocity({left:n.left,top:n.top},Helper.FX_DURATION,r)}},onReturnHelpersToDraggees:function(){Helper.requestAnimationFrame(t.proxy(function(){this.trigger("returnHelpersToDraggees"),this.settings.onReturnHelpersToDraggees()},this))},_createHelper:function(e){var i=this.$draggee.eq(e),s=i.clone().addClass("draghelper");this.settings.copyDraggeeInputValuesToHelper&&Helper.copyInputValues(i,s),s.css({width:i.width()+1,height:i.height(),margin:0}),this.settings.helper&&(s="function"==typeof this.settings.helper?this.settings.helper(s):t(this.settings.helper).append(s)),s.appendTo(Helper.$bod);var n=this._getHelperTarget(e);s.css({position:"absolute",top:n.top,left:n.left,zIndex:this.settings.helperBaseZindex+this.$draggee.length-e,opacity:this.settings.helperOpacity}),this.helperPositions[e]={top:n.top,left:n.left},this.helpers.push(s)},_updateHelperPos:function(){if(this.mouseX!==this.lastMouseX||this.mouseY!==this.lastMouseY){for(this._updateHelperPos._i=0;this._updateHelperPos._i<this.helpers.length;this._updateHelperPos._i++)this.helperTargets[this._updateHelperPos._i]=this._getHelperTarget(this._updateHelperPos._i);this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY}for(this._updateHelperPos._j=0;this._updateHelperPos._j<this.helpers.length;this._updateHelperPos._j++)this._updateHelperPos._lag=this.settings.helperLagBase+this.helperLagIncrement*this._updateHelperPos._j,this.helperPositions[this._updateHelperPos._j]={left:this.helperPositions[this._updateHelperPos._j].left+(this.helperTargets[this._updateHelperPos._j].left-this.helperPositions[this._updateHelperPos._j].left)/this._updateHelperPos._lag,top:this.helperPositions[this._updateHelperPos._j].top+(this.helperTargets[this._updateHelperPos._j].top-this.helperPositions[this._updateHelperPos._j].top)/this._updateHelperPos._lag},this.helpers[this._updateHelperPos._j].css(this.helperPositions[this._updateHelperPos._j]);this.updateHelperPosFrame=Helper.requestAnimationFrame(this.updateHelperPosProxy)},_getHelperTarget:function(t){return{left:this.getHelperTargetX()+this.settings.helperSpacingX*t,top:this.getHelperTargetY()+this.settings.helperSpacingY*t}},_showDraggee:function(){for(var t=0;t<this.helpers.length;t++)this.helpers[t].remove();this.helpers=null,this.$draggee.show().css("visibility","inherit"),this.onReturnHelpersToDraggees(),this._returningHelpersToDraggees=!1}},{defaults:{filter:null,singleHelper:!1,collapseDraggees:!1,removeDraggee:!1,copyDraggeeInputValuesToHelper:!1,helperOpacity:1,helper:null,helperBaseZindex:1e3,helperLagBase:1,helperLagIncrementDividend:1.5,helperSpacingX:5,helperSpacingY:5,onReturnHelpersToDraggees:t.noop}}),Helper.DragDrop=Helper.Drag.extend({$dropTargets:null,$activeDropTarget:null,init:function(e){e=t.extend({},Helper.DragDrop.defaults,e),this.base(e)},updateDropTargets:function(){this.settings.dropTargets&&(this.$dropTargets=t("function"==typeof this.settings.dropTargets?this.settings.dropTargets():this.settings.dropTargets),this.$dropTargets.length||(this.$dropTargets=null))},onDragStart:function(){this.updateDropTargets(),this.$activeDropTarget=null,this.base()},onDrag:function(){if(this.$dropTargets){for(this.onDrag._activeDropTarget=null,this.onDrag._i=0;this.onDrag._i<this.$dropTargets.length;this.onDrag._i++)if(this.onDrag._elem=this.$dropTargets[this.onDrag._i],Helper.hitTest(this.mouseX,this.mouseY,this.onDrag._elem)){this.onDrag._activeDropTarget=this.onDrag._elem;break}(this.$activeDropTarget&&this.onDrag._activeDropTarget!=this.$activeDropTarget[0]||!this.$activeDropTarget&&null!==this.onDrag._activeDropTarget)&&(this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass),this.$activeDropTarget=this.onDrag._activeDropTarget?t(this.onDrag._activeDropTarget).addClass(this.settings.activeDropTargetClass):null,this.settings.onDropTargetChange(this.$activeDropTarget))}this.base()},onDragStop:function(){this.$dropTargets&&this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass),this.base()},fadeOutHelpers:function(){for(var t=0;t<this.helpers.length;t++)!function(t){t.velocity("fadeOut",{duration:Helper.FX_DURATION,complete:function(){t.remove()}})}(this.helpers[t])}},{defaults:{dropTargets:null,onDropTargetChange:t.noop,activeDropTargetClass:"active"}}),Helper.DragMove=Helper.BaseDrag.extend({onDrag:function(){this.$targetItem.css({left:this.mouseX-this.mouseOffsetX,top:this.mouseY-this.mouseOffsetY})}}),Helper.DragSort=Helper.Drag.extend({$heightedContainer:null,$insertion:null,insertionVisible:!1,oldDraggeeIndexes:null,newDraggeeIndexes:null,closestItem:null,_midpointVersion:0,_$prevItem:null,init:function(e,i){"undefined"==typeof i&&t.isPlainObject(e)&&(i=e,e=null),i=t.extend({},Helper.DragSort.defaults,i),this.base(e,i)},createInsertion:function(){return this.settings.insertion?t("function"==typeof this.settings.insertion?this.settings.insertion(this.$draggee):this.settings.insertion):void 0},getHelperTargetX:function(){return 1!=this.settings.magnetStrength?(this.getHelperTargetX._draggeeOffsetX=this.$draggee.offset().left,this.getHelperTargetX._draggeeOffsetX+(this.mouseX-this.mouseOffsetX-this.getHelperTargetX._draggeeOffsetX)/this.settings.magnetStrength):this.base()},getHelperTargetY:function(){return 1!=this.settings.magnetStrength?(this.getHelperTargetY._draggeeOffsetY=this.$draggee.offset().top,this.getHelperTargetY._draggeeOffsetY+(this.mouseY-this.mouseOffsetY-this.getHelperTargetY._draggeeOffsetY)/this.settings.magnetStrength):this.base()},canInsertBefore:function(){return!0},canInsertAfter:function(){return!0},onDragStart:function(){if(this.oldDraggeeIndexes=this._getDraggeeIndexes(),this.settings.moveTargetItemToFront&&this.$draggee.length>1&&this._getItemIndex(this.$draggee[0])>this._getItemIndex(this.$draggee[1])&&this.$draggee.first().insertBefore(this.$draggee[1]),this.$insertion=this.createInsertion(),this._placeInsertionWithDraggee(),this.closestItem=null,this._clearMidpoints(),this.settings.container)for(this.$heightedContainer=t(this.settings.container);!this.$heightedContainer.height();)this.$heightedContainer=this.$heightedContainer.parent();this.base()},onDrag:function(){this.$heightedContainer&&!Helper.hitTest(this.mouseX,this.mouseY,this.$heightedContainer)?this.closestItem&&(this.closestItem=null,this._removeInsertion()):this.closestItem!==(this.closestItem=this._getClosestItem())&&null!==this.closestItem&&this._updateInsertion(),this.base()},onDragStop:function(){this._removeInsertion(),this.settings.moveTargetItemToFront||0==this.targetItemPositionInDraggee||this.$targetItem.insertAfter(this.$draggee.eq(this.targetItemPositionInDraggee)),this.returnHelpersToDraggees(),this.base(),this.$items=t().add(this.$items),this.newDraggeeIndexes=this._getDraggeeIndexes(),this.newDraggeeIndexes.join(",")!=this.oldDraggeeIndexes.join(",")&&this.onSortChange()},onInsertionPointChange:function(){Helper.requestAnimationFrame(t.proxy(function(){this.trigger("insertionPointChange"),this.settings.onInsertionPointChange()},this))},onSortChange:function(){Helper.requestAnimationFrame(t.proxy(function(){this.trigger("sortChange"),this.settings.onSortChange()
},this))},_getItemIndex:function(e){return t.inArray(e,this.$items)},_getDraggeeIndexes:function(){for(var t=[],e=0;e<this.$draggee.length;e++)t.push(this._getItemIndex(this.$draggee[e]));return t},_getClosestItem:function(){for(this._getClosestItem._closestItem=null,this.settings.removeDraggee?this.insertionVisible&&this._testForClosestItem(this.$insertion[0]):this._testForClosestItem(this.$draggee[0]),this._getClosestItem._closestItem&&(this._getClosestItem._midpoint=this._getItemMidpoint(this._getClosestItem._closestItem)),this.settings.axis!=Helper.Y_AXIS&&(this._getClosestItem._startXDist=this._getClosestItem._lastXDist=this._getClosestItem._closestItem?Math.abs(this._getClosestItem._midpoint.x-this.draggeeVirtualMidpointX):null),this.settings.axis!=Helper.X_AXIS&&(this._getClosestItem._startYDist=this._getClosestItem._lastYDist=this._getClosestItem._closestItem?Math.abs(this._getClosestItem._midpoint.y-this.draggeeVirtualMidpointY):null),this._getClosestItem._$otherItem=this.$draggee.first().prev();this._getClosestItem._$otherItem.length&&(this._getClosestItem._midpoint=this._getItemMidpoint(this._getClosestItem._$otherItem[0]),this.settings.axis!=Helper.Y_AXIS&&(this._getClosestItem._xDist=Math.abs(this._getClosestItem._midpoint.x-this.draggeeVirtualMidpointX)),this.settings.axis!=Helper.X_AXIS&&(this._getClosestItem._yDist=Math.abs(this._getClosestItem._midpoint.y-this.draggeeVirtualMidpointY)),!(this.settings.axis==Helper.Y_AXIS||null!==this._getClosestItem._lastXDist&&this._getClosestItem._xDist>this._getClosestItem._lastXDist)||!(this.settings.axis==Helper.X_AXIS||null!==this._getClosestItem._lastYDist&&this._getClosestItem._yDist>this._getClosestItem._lastYDist));)this.settings.axis!=Helper.Y_AXIS&&(this._getClosestItem._lastXDist=this._getClosestItem._xDist),this.settings.axis!=Helper.X_AXIS&&(this._getClosestItem._lastYDist=this._getClosestItem._yDist),this.canInsertBefore(this._getClosestItem._$otherItem)&&this._testForClosestItem(this._getClosestItem._$otherItem[0]),this._getClosestItem._$otherItem=this._getClosestItem._$otherItem.prev();for(this.settings.axis!=Helper.Y_AXIS&&(this._getClosestItem._lastXDist=this._getClosestItem._startXDist),this.settings.axis!=Helper.X_AXIS&&(this._getClosestItem._lastYDist=this._getClosestItem._startYDist),this._getClosestItem._$otherItem=this.$draggee.last().next();this._getClosestItem._$otherItem.length&&(this._getClosestItem._midpoint=this._getItemMidpoint(this._getClosestItem._$otherItem[0]),this.settings.axis!=Helper.Y_AXIS&&(this._getClosestItem._xDist=Math.abs(this._getClosestItem._midpoint.x-this.draggeeVirtualMidpointX)),this.settings.axis!=Helper.X_AXIS&&(this._getClosestItem._yDist=Math.abs(this._getClosestItem._midpoint.y-this.draggeeVirtualMidpointY)),!(this.settings.axis==Helper.Y_AXIS||null!==this._getClosestItem._lastXDist&&this._getClosestItem._xDist>this._getClosestItem._lastXDist)||!(this.settings.axis==Helper.X_AXIS||null!==this._getClosestItem._lastYDist&&this._getClosestItem._yDist>this._getClosestItem._lastYDist));)this.settings.axis!=Helper.Y_AXIS&&(this._getClosestItem._lastXDist=this._getClosestItem._xDist),this.settings.axis!=Helper.X_AXIS&&(this._getClosestItem._lastYDist=this._getClosestItem._yDist),this.canInsertAfter(this._getClosestItem._$otherItem)&&this._testForClosestItem(this._getClosestItem._$otherItem[0]),this._getClosestItem._$otherItem=this._getClosestItem._$otherItem.next();return this._getClosestItem._closestItem==this.$draggee[0]||this.insertionVisible&&this._getClosestItem._closestItem==this.$insertion[0]?null:this._getClosestItem._closestItem},_clearMidpoints:function(){this._midpointVersion++,this._$prevItem=null},_getItemMidpoint:function(e){return t.data(e,"midpointVersion")!=this._midpointVersion&&(this._getItemMidpoint._repositionDraggee=!(this.settings.axis||this.settings.removeDraggee&&!this.insertionVisible||e==this.$draggee[0]||this.$insertion&&e==this.$insertion.get(0)),this._getItemMidpoint._repositionDraggee?(this._$prevItem||(this._$prevItem=(this.insertionVisible?this.$insertion:this.$draggee).first().prev()),this._moveDraggeeToItem(e),this._getItemMidpoint._$item=this.settings.removeDraggee?this.$insertion:this.$draggee):this._getItemMidpoint._$item=t(e),this._getItemMidpoint._offset=this._getItemMidpoint._$item.offset(),t.data(e,"midpoint",{x:this._getItemMidpoint._offset.left+this._getItemMidpoint._$item.outerWidth()/2,y:this._getItemMidpoint._offset.top+this._getItemMidpoint._$item.outerHeight()/2}),t.data(e,"midpointVersion",this._midpointVersion),delete this._getItemMidpoint._$item,delete this._getItemMidpoint._offset,this._getItemMidpoint._repositionDraggee&&(this._$prevItem.length?this.$draggee.insertAfter(this._$prevItem):this.$draggee.prependTo(this.$draggee.parent()),this._placeInsertionWithDraggee())),t.data(e,"midpoint")},_testForClosestItem:function(t){this._testForClosestItem._midpoint=this._getItemMidpoint(t),this._testForClosestItem._mouseDistX=Math.abs(this._testForClosestItem._midpoint.x-this.draggeeVirtualMidpointX),this._testForClosestItem._mouseDistY=Math.abs(this._testForClosestItem._midpoint.y-this.draggeeVirtualMidpointY),(null===this._getClosestItem._closestItem||this._testForClosestItem._mouseDistY<this._getClosestItem._closestItemMouseDistY||this._testForClosestItem._mouseDistY==this._getClosestItem._closestItemMouseDistY&&this._testForClosestItem._mouseDistX<=this._getClosestItem._closestItemMouseDistX)&&(this._getClosestItem._closestItem=t,this._getClosestItem._closestItemMouseDistX=this._testForClosestItem._mouseDistX,this._getClosestItem._closestItemMouseDistY=this._testForClosestItem._mouseDistY)},_updateInsertion:function(){this.closestItem&&this._moveDraggeeToItem(this.closestItem),this._clearMidpoints(),this.onInsertionPointChange()},_moveDraggeeToItem:function(e){this.$draggee.index()<t(e).index()?this.$draggee.insertAfter(e):this.$draggee.insertBefore(e),this._placeInsertionWithDraggee()},_placeInsertionWithDraggee:function(){this.$insertion&&(this.$insertion.insertBefore(this.$draggee.first()),this.insertionVisible=!0)},_removeInsertion:function(){this.insertionVisible&&(this.$insertion.remove(),this.insertionVisible=!1)}},{defaults:{container:null,insertion:null,moveTargetItemToFront:!1,magnetStrength:1,onInsertionPointChange:t.noop,onSortChange:t.noop}}),Helper.EscManager=Helper.Base.extend({handlers:null,init:function(){this.handlers=[],this.addListener(Helper.$bod,"keyup",function(t){t.keyCode==Helper.ESC_KEY&&this.escapeLatest(t)})},register:function(t,e){this.handlers.push({obj:t,func:e})},unregister:function(t){for(var e=this.handlers.length-1;e>=0;e--)this.handlers[e].obj==t&&this.handlers.splice(e,1)},escapeLatest:function(t){if(this.handlers.length){var e=this.handlers.pop();if("function"==typeof e.func)var i=e.func;else var i=e.obj[e.func];i.call(e.obj,t),"function"==typeof e.obj.trigger&&e.obj.trigger("escape")}}}),Helper.escManager=new Helper.EscManager,Helper.HUD=Helper.Base.extend({$trigger:null,$hud:null,$tip:null,$body:null,$shade:null,windowWidth:null,windowHeight:null,windowScrollLeft:null,windowScrollTop:null,triggerWidth:null,triggerHeight:null,triggerOffset:null,width:null,height:null,showing:!1,position:null,init:function(e,i,s){this.$trigger=t(e),this.setSettings(s,Helper.HUD.defaults),this.on("show",this.settings.onShow),this.on("hide",this.settings.onHide),"undefined"==typeof Helper.HUD.activeHUDs&&(Helper.HUD.activeHUDs={}),this.$shade=t('<div class="hud-shade"/>'),this.$hud=t('<div class="'+this.settings.hudClass+'" />'),this.$tip=t('<div class="'+this.settings.tipClass+'" />').appendTo(this.$hud),this.$body=t('<div class="'+this.settings.bodyClass+'" />').appendTo(this.$hud).append(i),this.$body.find(".footer").length&&this.$hud.addClass("has-footer"),this.show()},show:function(t){if(t&&t.stopPropagation&&t.stopPropagation(),!this.showing){if(this.settings.closeOtherHUDs)for(var e in Helper.HUD.activeHUDs)Helper.HUD.activeHUDs[e].hide();this.$hud.css("top",Helper.$win.scrollTop()),this.$shade.appendTo(Helper.$bod),this.$hud.appendTo(Helper.$bod),this.$hud.show(),this.determineBestPosition(),this.setPosition(),this.$shade.show(),this.showing=!0,Helper.HUD.activeHUDs[this._namespace]=this,Helper.escManager.register(this,"hide"),this.addListener(this.$hud,"resize","resetPosition"),this.addListener(Helper.$win,"resize","resetPosition"),this.addListener(this.$shade,"click","hide"),this.settings.closeBtn&&this.addListener(this.settings.closeBtn,"activate","hide"),this.onShow()}},onShow:function(){this.trigger("show")},updateElementProperties:function(){this.windowWidth=Helper.$win.width(),this.windowHeight=Helper.$win.height(),this.windowScrollLeft=Helper.$win.scrollLeft(),this.windowScrollTop=Helper.$win.scrollTop(),this.triggerWidth=this.$trigger.outerWidth(),this.triggerHeight=this.$trigger.outerHeight(),this.triggerOffset=this.$trigger.offset(),this.triggerOffset.right=this.triggerOffset.left+this.triggerWidth,this.triggerOffset.bottom=this.triggerOffset.top+this.triggerHeight,this.width=this.$hud.outerWidth(),this.height=this.$hud.outerHeight()},determineBestPosition:function(){this.updateElementProperties(),this.minHorizontalClearance=this.width+this.settings.triggerSpacing+this.settings.windowSpacing,this.minVerticalClearance=this.height+this.settings.triggerSpacing+this.settings.windowSpacing;for(var e=[this.windowHeight+this.windowScrollTop-this.triggerOffset.bottom,this.triggerOffset.top-this.windowScrollTop,this.windowWidth+this.windowScrollLeft-this.triggerOffset.right,this.triggerOffset.left-this.windowScrollLeft],i=0;4>i;i++){var s=2>i?"height":"width";if(e[i]-(this.settings.windowSpacing+this.settings.triggerSpacing)>=this[s]){var n=i;break}}if("undefined"==typeof n)var r=Math.max.apply(null,e),n=t.inArray(r,e);this.position=Helper.HUD.positions[n],this.tipClass&&this.$tip.removeClass(this.tipClass),this.tipClass=this.settings.tipClass+"-"+Helper.HUD.tipClasses[n],this.$tip.addClass(this.tipClass)},setPosition:function(){if("top"==this.position||"bottom"==this.position){var t=this.windowWidth+this.windowScrollLeft-(this.width+this.settings.windowSpacing),e=this.windowScrollLeft+this.settings.windowSpacing,i=this.triggerOffset.left+Math.round(this.triggerWidth/2),s=i-Math.round(this.width/2);s>t&&(s=t),e>s&&(s=e),this.$hud.css("left",s);var n=i-s-this.settings.tipWidth/2;if(this.$tip.css({left:n,top:""}),"top"==this.position){var r=this.triggerOffset.top-(this.height+this.settings.triggerSpacing);this.$hud.css("top",r)}else{var r=this.triggerOffset.bottom+this.settings.triggerSpacing;this.$hud.css("top",r)}}else{var o=this.windowHeight+this.windowScrollTop-(this.height+this.settings.windowSpacing),h=this.windowScrollTop+this.settings.windowSpacing,i=this.triggerOffset.top+Math.round(this.triggerHeight/2),r=i-Math.round(this.height/2);r>o&&(r=o),h>r&&(r=h),this.$hud.css("top",r);var a=i-r-this.settings.tipWidth/2;if(this.$tip.css({top:a,left:""}),"left"==this.position){var s=this.triggerOffset.left-(this.width+this.settings.triggerSpacing);this.$hud.css("left",s)}else{var s=this.triggerOffset.right+this.settings.triggerSpacing;this.$hud.css("left",s)}}},resetPosition:function(){this.updateElementProperties(),this.setPosition()},hide:function(){this.$hud.hide(),this.$shade.hide(),this.showing=!1,delete Helper.HUD.activeHUDs[this._namespace],Helper.escManager.unregister(this),this.onHide()},onHide:function(){this.trigger("hide")},toggle:function(){this.showing?this.hide():this.show()}},{positions:["bottom","top","right","left"],tipClasses:["top","bottom","left","right"],defaults:{hudClass:"hud",tipClass:"tip",bodyClass:"body",triggerSpacing:10,windowSpacing:10,tipWidth:30,onShow:t.noop,onHide:t.noop,closeBtn:null,closeOtherHUDs:!0}}),Helper.LightSwitch=Helper.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,$toggleTarget:null,on:null,dragger:null,dragStartMargin:null,init:function(e,i){this.$outerContainer=t(e),this.$outerContainer.data("lightswitch")&&(Helper.log("Double-instantiating a switch on an element"),this.$outerContainer.data("lightswitch").destroy()),this.$outerContainer.data("lightswitch",this),this.setSettings(i,Helper.LightSwitch.defaults),this.$innerContainer=this.$outerContainer.find(".container:first"),this.$input=this.$outerContainer.find("input:first"),this.$toggleTarget=t(this.$outerContainer.attr("data-toggle")),this.on=this.$outerContainer.hasClass("on"),this.addListener(this.$outerContainer,"mousedown","_handleMouseDown"),this.addListener(this.$outerContainer,"keydown","_handleKeyDown"),this.dragger=new Helper.BaseDrag(this.$outerContainer,{axis:Helper.X_AXIS,ignoreHandleSelector:null,onDragStart:t.proxy(this,"_handleDragStart"),onDrag:t.proxy(this,"_handleDrag"),onDragStop:t.proxy(this,"_handleDragStop")})},turnOn:function(){this.$innerContainer.velocity("stop").velocity({marginLeft:0},Helper.FX_DURATION),this.$input.val(Helper.Y_AXIS),this.on=!0,this.onChange(),this.$toggleTarget.show(),this.$toggleTarget.height("auto");var e=this.$toggleTarget.height();this.$toggleTarget.height(0),this.$toggleTarget.velocity("stop").velocity({height:e},Helper.FX_DURATION,t.proxy(function(){this.$toggleTarget.height("auto")},this))},turnOff:function(){this.$innerContainer.velocity("stop").velocity({marginLeft:Helper.LightSwitch.offMargin},Helper.FX_DURATION),this.$input.val(""),this.on=!1,this.onChange(),this.$toggleTarget.velocity("stop").velocity({height:0},Helper.FX_DURATION)},toggle:function(){this.on?this.turnOff():this.turnOn()},onChange:function(){this.trigger("change"),this.settings.onChange(),this.$outerContainer.trigger("change")},_handleMouseDown:function(){this.addListener(Helper.$doc,"mouseup","_handleMouseUp")},_handleMouseUp:function(){this.removeListener(Helper.$doc,"mouseup"),this.dragger.dragging||this.toggle()},_handleKeyDown:function(t){switch(t.keyCode){case Helper.SPACE_KEY:this.toggle(),t.preventDefault();break;case Helper.RIGHT_KEY:Helper.ltr?this.turnOn():this.turnOff(),t.preventDefault();break;case Helper.LEFT_KEY:Helper.ltr?this.turnOff():this.turnOn(),t.preventDefault()}},_getMargin:function(){return parseInt(this.$innerContainer.css("marginLeft"))},_handleDragStart:function(){this.dragStartMargin=this._getMargin()},_handleDrag:function(){var t=this.dragStartMargin+this.dragger.mouseDistX;t<Helper.LightSwitch.offMargin?t=Helper.LightSwitch.offMargin:t>0&&(t=0),this.$innerContainer.css("marginLeft",t)},_handleDragStop:function(){var t=this._getMargin();t>-16?this.turnOn():this.turnOff()},destroy:function(){this.$outerContainer.removeData("lightswitch"),this.dragger.destroy(),this.base()}},{offMargin:-50,defaults:{onChange:t.noop}}),Helper.Menu=Helper.Base.extend({settings:null,$container:null,$options:null,$trigger:null,_windowWidth:null,_windowHeight:null,_windowScrollLeft:null,_windowScrollTop:null,_triggerOffset:null,_triggerWidth:null,_triggerHeight:null,_triggerOffsetRight:null,_triggerOffsetBottom:null,_menuWidth:null,_menuHeight:null,init:function(e,i){this.setSettings(i,Helper.Menu.defaults),this.$container=t(e),this.$options=t(),this.addOptions(this.$container.find("a")),this.settings.attachToElement&&(this.$trigger=t(this.settings.attachToElement)),this.addListener(this.$container,"mousedown",function(t){t.stopPropagation()})},addOptions:function(t){this.$options=this.$options.add(t),t.data("menu",this),this.addListener(t,"click","selectOption")},setPositionRelativeToTrigger:function(){this._windowWidth=Helper.$win.width(),this._windowHeight=Helper.$win.height(),this._windowScrollLeft=Helper.$win.scrollLeft(),this._windowScrollTop=Helper.$win.scrollTop(),this._triggerOffset=this.$trigger.offset(),this._triggerWidth=this.$trigger.outerWidth(),this._triggerHeight=this.$trigger.outerHeight(),this._triggerOffsetRight=this._triggerOffset.left+this._triggerHeight,this._triggerOffsetBottom=this._triggerOffset.top+this._triggerHeight,this.$container.css("minWidth",0),this.$container.css("minWidth",this._triggerWidth-(this.$container.outerWidth()-this.$container.width())),this._menuWidth=this.$container.outerWidth(),this._menuHeight=this.$container.outerHeight();var t=this._triggerOffset.top-this._windowScrollTop,e=this._windowHeight+this._windowScrollTop-this._triggerOffsetBottom;e>=this._menuHeight||e>=t?this.$container.css("top",this._triggerOffsetBottom):this.$container.css("top",this._triggerOffset.top-this._menuHeight);var i=this.$container.data("align");if("left"!=i&&"center"!=i&&"right"!=i&&(i="left"),"center"==i)this._alignCenter();else{var s=this._windowWidth+this._windowScrollLeft-(this._triggerOffset.left+this._menuWidth),n=this._triggerOffsetRight-this._menuWidth;"right"==i&&n>=0||0>s?this._alignRight():this._alignLeft()}delete this._windowWidth,delete this._windowHeight,delete this._windowScrollLeft,delete this._windowScrollTop,delete this._triggerOffset,delete this._triggerWidth,delete this._triggerHeight,delete this._triggerOffsetRight,delete this._triggerOffsetBottom,delete this._menuWidth,delete this._menuHeight},show:function(){this.$container.appendTo(Helper.$bod),this.$trigger&&this.setPositionRelativeToTrigger(),this.$container.velocity("stop"),this.$container.css({opacity:1,display:"block"}),Helper.escManager.register(this,"hide")},hide:function(){this.$container.velocity("fadeOut",{duration:Helper.FX_DURATION},t.proxy(function(){this.$container.detach()},this)),Helper.escManager.unregister(this),this.trigger("hide")},selectOption:function(t){this.settings.onOptionSelect(t.currentTarget),this.trigger("optionselect",{selectedOption:t.currentTarget}),this.hide()},_alignLeft:function(){this.$container.css({left:this._triggerOffset.left,right:"auto"})},_alignRight:function(){this.$container.css({right:this._windowWidth-(this._triggerOffset.left+this._triggerWidth),left:"auto"})},_alignCenter:function(){var t=Math.round(this._triggerOffset.left+this._triggerWidth/2-this._menuWidth/2);0>t&&(t=0),this.$container.css("left",t)}},{defaults:{attachToElement:null,onOptionSelect:t.noop}}),Helper.MenuBtn=Helper.Base.extend({$btn:null,menu:null,showingMenu:!1,disabled:!0,init:function(e,i){if(this.$btn=t(e),this.$btn.data("menubtn")){var s=this.$btn.data("menubtn").menu.$container;Helper.log("Double-instantiating a menu button on an element"),this.$btn.data("menubtn").destroy()}else var s=this.$btn.next(".menu").detach();this.$btn.data("menubtn",this),this.setSettings(i,Helper.MenuBtn.defaults),this.menu=new Helper.Menu(s,{attachToElement:this.$btn,onOptionSelect:t.proxy(this,"onOptionSelect")}),this.menu.on("hide",t.proxy(this,"onMenuHide")),this.addListener(this.$btn,"mousedown","onMouseDown"),this.enable()},onMouseDown:function(t){t.which!=Helper.PRIMARY_CLICK||t.metaKey||(t.preventDefault(),this.showingMenu?this.hideMenu():this.showMenu())},showMenu:function(){this.disabled||(this.menu.show(),this.$btn.addClass("active"),this.showingMenu=!0,setTimeout(t.proxy(function(){this.addListener(Helper.$doc,"mousedown","onMouseDown")},this),1),Helper.isMobileBrowser()||this.addListener(Helper.$win,"resize","hideMenu"))},hideMenu:function(){Helper.isMobileBrowser()||this.removeListener(Helper.$win,"resize"),this.menu.hide()},onMenuHide:function(){this.$btn.removeClass("active"),this.showingMenu=!1,this.removeListener(Helper.$doc,"mousedown"),Helper.isMobileBrowser()||this.removeListener(Helper.$doc,"resize")},onOptionSelect:function(t){this.settings.onOptionSelect(t),this.trigger("optionSelect",{option:t})},enable:function(){this.disabled=!1},disable:function(){this.disabled=!0},destroy:function(){this.$btn.removeData("menubtn"),this.base()}},{defaults:{onOptionSelect:t.noop}}),Helper.MixedInput=Helper.Base.extend({$container:null,elements:null,focussedElement:null,blurTimeout:null,init:function(e,i){this.$container=t(e),this.setSettings(i,Helper.MixedInput.defaults),this.elements=[],this.$container.attr("tabindex",0),this.addListener(this.$container,"focus","onFocus")},getElementIndex:function(e){return t.inArray(e,this.elements)},isText:function(t){return"INPUT"==t.prop("nodeName")},onFocus:function(){if(this.elements.length){var t=this.elements[0];this.setFocus(t),this.setCarotPos(t,0)}else this.addTextElement()},addTextElement:function(t){var e=new n(this);return this.addElement(e.$input,t),e},addElement:function(e,i){if("undefined"==typeof i)if(this.focussedElement){var s=this.focussedElement,r=this.getElementIndex(s);if(this.isText(s)){var o=s.prop("selectionStart"),h=s.prop("selectionEnd"),a=s.val(),l=a.substring(0,o),g=a.substr(h);if(l&&g){s.val(l).trigger("change");var d=new n(this);d.$input.val(g).trigger("change"),this.addElement(d.$input,r+1),i=r+1}else i=l?r+1:r}else i=r+1}else i=this.elements.length;"undefined"!=typeof this.elements[i]?(e.insertBefore(this.elements[i]),this.elements.splice(i,0,e)):(i=this.elements.length,this.$container.append(e),this.elements.push(e)),this.isText(e)||(0!=i&&this.isText(this.elements[i-1])||(this.addTextElement(i),i++),i!=this.elements.length-1&&this.isText(this.elements[i+1])||this.addTextElement(i+1)),this.addListener(e,"click",function(){this.setFocus(e)}),setTimeout(t.proxy(function(){this.setFocus(e)},this),1)},removeElement:function(t){var e=this.getElementIndex(t);if(-1!=e){if(this.elements.splice(e,1),!this.isText(t)){var i=this.elements[e-1],s=this.elements[e];if(this.isText(i)&&this.isText(s)){var n=i.val(),r=n+s.val();i.val(r).trigger("change"),this.removeElement(s),this.setFocus(i),this.setCarotPos(i,n.length)}}t.remove()}},setFocus:function(e){this.$container.addClass("focus"),this.focussedElement?this.blurFocussedElement():this.$container.attr("tabindex","-1"),e.attr("tabindex","0"),e.focus(),this.focussedElement=e,this.addListener(e,"blur",function(){this.blurTimeout=setTimeout(t.proxy(function(){this.focussedElement==e&&(this.blurFocussedElement(),this.focussedElement=null,this.$container.removeClass("focus"),this.$container.attr("tabindex","0"))},this),1)})},blurFocussedElement:function(){this.removeListener(this.focussedElement,"blur"),this.focussedElement.attr("tabindex","-1")},focusPreviousElement:function(t){var e=this.getElementIndex(t);if(e>0){var i=this.elements[e-1];if(this.setFocus(i),this.isText(i)){var s=i.val().length;this.setCarotPos(i,s)}}},focusNextElement:function(t){var e=this.getElementIndex(t);if(e<this.elements.length-1){var i=this.elements[e+1];this.setFocus(i),this.isText(i)&&this.setCarotPos(i,0)}},setCarotPos:function(t,e){t.prop("selectionStart",e),t.prop("selectionEnd",e)}});var n=Helper.Base.extend({parentInput:null,$input:null,$stage:null,val:null,focussed:!1,interval:null,init:function(e){this.parentInput=e,this.$input=t('<input type="text"/>').appendTo(this.parentInput.$container),this.$input.css("margin-right",2-n.padding+"px"),this.setWidth(),this.addListener(this.$input,"focus","onFocus"),this.addListener(this.$input,"blur","onBlur"),this.addListener(this.$input,"keydown","onKeyDown"),this.addListener(this.$input,"change","checkInput")},getIndex:function(){return this.parentInput.getElementIndex(this.$input)},buildStage:function(){this.$stage=t("<stage/>").appendTo(Helper.$bod),this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"nowrap"}),Helper.copyTextStyles(this.$input,this.$stage)},getTextWidth:function(t){return this.$stage||this.buildStage(),t&&(t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;")),this.$stage.html(t),this.stageWidth=this.$stage.width(),this.stageWidth},onFocus:function(){this.focussed=!0,this.interval=setInterval(t.proxy(this,"checkInput"),Helper.NiceText.interval),this.checkInput()},onBlur:function(){this.focussed=!1,clearInterval(this.interval),this.checkInput()},onKeyDown:function(e){switch(setTimeout(t.proxy(this,"checkInput"),1),e.keyCode){case Helper.LEFT_KEY:0==this.$input.prop("selectionStart")&&0==this.$input.prop("selectionEnd")&&this.parentInput.focusPreviousElement(this.$input);break;case Helper.RIGHT_KEY:this.$input.prop("selectionStart")==this.val.length&&this.$input.prop("selectionEnd")==this.val.length&&this.parentInput.focusNextElement(this.$input);break;case Helper.DELETE_KEY:0==this.$input.prop("selectionStart")&&0==this.$input.prop("selectionEnd")&&(this.parentInput.focusPreviousElement(this.$input),e.preventDefault())}},getVal:function(){return this.val=this.$input.val(),this.val},setVal:function(t){this.$input.val(t),this.checkInput()},checkInput:function(){var t=this.val!==this.getVal();return t&&(this.setWidth(),this.onChange()),t},setWidth:function(){if(this.stageWidth!==this.getTextWidth(this.val)){var t=this.stageWidth+n.padding;this.$input.width(t)}},onChange:t.noop},{padding:20});Helper.Modal=Helper.Base.extend({$container:null,$shade:null,visible:!1,dragger:null,desiredWidth:null,desiredHeight:null,resizeDragger:null,resizeStartWidth:null,resizeStartHeight:null,init:function(e,i){"undefined"==typeof i&&t.isPlainObject(e)&&(i=e,e=null),this.setSettings(i,Helper.Modal.defaults),this.$shade=t('<div class="'+this.settings.shadeClass+'"/>'),e?this.$shade.insertBefore(e):this.$shade.appendTo(Helper.$bod),e&&(this.setContainer(e),this.settings.autoShow&&this.show()),Helper.Modal.instances.push(this)},setContainer:function(e){if(this.$container=t(e),this.$container.data("modal")&&(Helper.log("Double-instantiating a modal on an element"),this.$container.data("modal").destroy()),this.$container.data("modal",this),this.settings.draggable&&(this.dragger=new Helper.DragMove(this.$container,{handle:this.settings.dragHandleSelector?this.$container.find(this.settings.dragHandleSelector):this.$container})),this.settings.resizable){var i=t('<div class="resizehandle"/>').appendTo(this.$container);this.resizeDragger=new Helper.BaseDrag(i,{onDragStart:t.proxy(this,"_handleResizeStart"),onDrag:t.proxy(this,"_handleResize")})}this.addListener(this.$container,"click",function(t){t.stopPropagation()}),this.visible&&this.show()},show:function(){this.settings.closeOtherModals&&Helper.Modal.visibleModal&&Helper.Modal.visibleModal!=this&&Helper.Modal.visibleModal.hide(),this.$container&&(this.$shade.appendTo(Helper.$bod),this.$container.appendTo(Helper.$bod),this.$container.show(),this.updateSizeAndPosition(),this.$shade.velocity("fadeIn",{duration:50}),this.$container.delay(50).velocity("fadeIn",{complete:t.proxy(this,"onFadeIn")}),this.settings.hideOnShadeClick&&this.addListener(this.$shade,"click","hide"),this.addListener(Helper.$win,"resize","updateSizeAndPosition")),this.settings.hideOnEsc&&Helper.escManager.register(this,"hide"),this.visible||(this.visible=!0,Helper.Modal.visibleModal=this,this.trigger("show"),this.settings.onShow())},quickShow:function(){this.show(),this.$container&&(this.$container.velocity("stop"),this.$container.show().css("opacity",1),this.$shade.velocity("stop"),this.$shade.show().css("opacity",1))},hide:function(e){e&&e.stopPropagation(),this.$container&&(this.$container.velocity("fadeOut",{duration:Helper.FX_DURATION}),this.$shade.velocity("fadeOut",{duration:Helper.FX_DURATION,complete:t.proxy(this,"onFadeOut")}),this.settings.hideOnShadeClick&&this.removeListener(this.$shade,"click"),this.removeListener(Helper.$win,"resize")),this.visible=!1,Helper.Modal.visibleModal=null,this.settings.hideOnEsc&&Helper.escManager.unregister(this),this.trigger("hide"),this.settings.onHide()},quickHide:function(){this.hide(),this.$container&&(this.$container.velocity("stop"),this.$container.css("opacity",0).hide(),this.$shade.velocity("stop"),this.$shade.css("opacity",0).hide())},updateSizeAndPosition:function(){this.$container&&(this.$container.css({width:this.desiredWidth?Math.max(this.desiredWidth,200):"",height:this.desiredHeight?Math.max(this.desiredHeight,200):"","min-width":"","min-height":""}),this.updateSizeAndPosition._windowWidth=Helper.$win.width(),this.updateSizeAndPosition._width=Math.min(this.getWidth(),this.updateSizeAndPosition._windowWidth-20),this.$container.css({width:this.updateSizeAndPosition._width,"min-width":this.updateSizeAndPosition._width,left:Math.round((this.updateSizeAndPosition._windowWidth-this.updateSizeAndPosition._width)/2)}),this.updateSizeAndPosition._windowHeight=Helper.$win.height(),this.updateSizeAndPosition._height=Math.min(this.getHeight(),this.updateSizeAndPosition._windowHeight-20),this.$container.css({height:this.updateSizeAndPosition._height,"min-height":this.updateSizeAndPosition._height,top:Math.round((this.updateSizeAndPosition._windowHeight-this.updateSizeAndPosition._height)/2)}))},onFadeIn:function(){this.trigger("fadeIn"),this.settings.onFadeIn()},onFadeOut:function(){this.trigger("fadeOut"),this.settings.onFadeOut()},getHeight:function(){if(!this.$container)throw"Attempted to get the height of a modal whose container has not been set.";return this.visible||this.$container.show(),this.getHeight._height=this.$container.outerHeight(),this.visible||this.$container.hide(),this.getHeight._height},getWidth:function(){if(!this.$container)throw"Attempted to get the width of a modal whose container has not been set.";return this.visible||this.$container.show(),this.getWidth._width=this.$container.outerWidth(),this.visible||this.$container.hide(),this.getWidth._width},_handleResizeStart:function(){this.resizeStartWidth=this.getWidth(),this.resizeStartHeight=this.getHeight()},_handleResize:function(){this.desiredWidth=Helper.ltr?this.resizeStartWidth+2*this.resizeDragger.mouseDistX:this.resizeStartWidth-2*this.resizeDragger.mouseDistX,this.desiredHeight=this.resizeStartHeight+2*this.resizeDragger.mouseDistY,this.updateSizeAndPosition()},destroy:function(){this.$container&&this.$container.removeData("modal").remove(),this.dragger&&this.dragger.destroy(),this.resizeDragger&&this.resizeDragger.destroy(),this.base()}},{relativeElemPadding:8,defaults:{autoShow:!0,draggable:!1,dragHandleSelector:null,resizable:!1,onShow:t.noop,onHide:t.noop,onFadeIn:t.noop,onFadeOut:t.noop,closeOtherModals:!0,hideOnEsc:!0,hideOnShadeClick:!0,shadeClass:"modal-shade"},instances:[],visibleModal:null}),Helper.NiceText=Helper.Base.extend({$input:null,$hint:null,$stage:null,$charsLeft:null,autoHeight:null,maxLength:null,showCharsLeft:!1,showingHint:!1,val:null,inputBoxSizing:"content-box",height:null,minHeight:null,initialized:!1,init:function(e,i){this.$input=t(e),this.settings=t.extend({},Helper.NiceText.defaults,i),this.maxLength=this.$input.attr("maxlength"),this.maxLength&&(this.maxLength=parseInt(this.maxLength)),this.maxLength&&(this.settings.showCharsLeft||Helper.hasAttr(this.$input,"data-show-chars-left"))&&(this.showCharsLeft=!0,this.$input.removeAttr("maxlength")),this.$input.data("nicetext")&&(Helper.log("Double-instantiating a transparent text input on an element"),this.$input.data("nicetext").destroy()),this.$input.data("nicetext",this),this.getVal(),this.autoHeight=this.settings.autoHeight&&"TEXTAREA"==this.$input.prop("nodeName"),this.autoHeight&&(this.minHeight=this.getHeightForValue(""),this.updateHeight(),this.addListener(Helper.$win,"resize","updateHeight")),this.settings.hint&&(this.$hintContainer=t('<div class="texthint-container"/>').insertBefore(this.$input),this.$hint=t('<div class="texthint">'+this.settings.hint+"</div>").appendTo(this.$hintContainer),this.$hint.css({top:parseInt(this.$input.css("borderTopWidth"))+parseInt(this.$input.css("paddingTop")),left:parseInt(this.$input.css("borderLeftWidth"))+parseInt(this.$input.css("paddingLeft"))+1}),Helper.copyTextStyles(this.$input,this.$hint),this.val?this.$hint.hide():this.showingHint=!0,this.addListener(this.$hint,"mousedown",function(t){t.preventDefault(),this.$input.focus()})),this.showCharsLeft&&(this.$charsLeft=t('<div class="'+this.settings.charsLeftClass+'"/>').insertAfter(this.$input),this.updateCharsLeft()),this.addListener(this.$input,"textchange","onTextChange"),this.initialized=!0},getVal:function(){return this.val=this.$input.val(),this.val},showHint:function(){this.$hint.velocity("fadeIn",{complete:Helper.NiceText.hintFadeDuration}),this.showingHint=!0},hideHint:function(){this.$hint.velocity("fadeOut",{complete:Helper.NiceText.hintFadeDuration}),this.showingHint=!1
},onTextChange:function(){this.getVal(),this.$hint&&(this.showingHint&&this.val?this.hideHint():this.showingHint||this.val||this.showHint()),this.autoHeight&&this.updateHeight(),this.showCharsLeft&&this.updateCharsLeft()},buildStage:function(){this.$stage=t("<stage/>").appendTo(Helper.$bod),this.$stage.css({display:"block",position:"absolute",top:-9999,left:-9999}),this.inputBoxSizing=this.$input.css("box-sizing"),"border-box"==this.inputBoxSizing&&this.$stage.css({"border-top":this.$input.css("border-top"),"border-right":this.$input.css("border-right"),"border-bottom":this.$input.css("border-bottom"),"border-left":this.$input.css("border-left"),"padding-top":this.$input.css("padding-top"),"padding-right":this.$input.css("padding-right"),"padding-bottom":this.$input.css("padding-bottom"),"padding-left":this.$input.css("padding-left"),"-webkit-box-sizing":this.inputBoxSizing,"-moz-box-sizing":this.inputBoxSizing,"box-sizing":this.inputBoxSizing}),Helper.copyTextStyles(this.$input,this.$stage)},getHeightForValue:function(t){if(this.$stage||this.buildStage(),"border-box"==this.inputBoxSizing?this.$stage.css("width",this.$input.outerWidth()):this.$stage.css("width",this.$input.width()),t)t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/[\n\r]$/g,""),t=t.replace(/[\n\r]/g,"<br/>"),t+="<br/>&nbsp;";else{t="&nbsp;";for(var e=1;e<this.$input.prop("rows");e++)t+="<br/>&nbsp;"}return this.$stage.html(t),this.getHeightForValue._height="border-box"==this.inputBoxSizing?this.$stage.outerHeight():this.$stage.height(),this.minHeight&&this.getHeightForValue._height<this.minHeight&&(this.getHeightForValue._height=this.minHeight),this.getHeightForValue._height},updateHeight:function(){this.height!==(this.height=this.getHeightForValue(this.val))&&(this.$input.css("min-height",this.height),this.initialized&&this.onHeightChange())},onHeightChange:function(){this.settings.onHeightChange()},updateCharsLeft:function(){this.updateCharsLeft._charsLeft=this.maxLength-this.val.length,this.$charsLeft.text(this.updateCharsLeft._charsLeft),this.updateCharsLeft._charsLeft>=0?this.$charsLeft.removeClass(this.settings.negativeCharsLeftClass):this.$charsLeft.addClass(this.settings.negativeCharsLeftClass)},destroy:function(){this.$input.removeData("nicetext"),this.$hint&&this.$hint.remove(),this.$stage&&this.$stage.remove(),this.base()}},{interval:100,hintFadeDuration:50,defaults:{autoHeight:!0,showCharsLeft:!1,charsLeftClass:"chars-left",negativeCharsLeftClass:"negative-chars-left",onHeightChange:t.noop}}),Helper.Pill=Helper.Base.extend({$outerContainer:null,$innerContainer:null,$btns:null,$selectedBtn:null,$input:null,init:function(e){this.$outerContainer=t(e),this.$outerContainer.data("pill")&&(Helper.log("Double-instantiating a pill on an element"),this.$outerContainer.data("pill").destroy()),this.$outerContainer.data("pill",this),this.$innerContainer=this.$outerContainer.find(".btngroup:first"),this.$btns=this.$innerContainer.find(".btn"),this.$selectedBtn=this.$btns.filter(".active:first"),this.$input=this.$outerContainer.find("input:first"),Helper.preventOutlineOnMouseFocus(this.$innerContainer),this.addListener(this.$btns,"mousedown","onMouseDown"),this.addListener(this.$innerContainer,"keydown","onKeyDown")},select:function(e){this.$selectedBtn.removeClass("active");var i=t(e);i.addClass("active"),this.$input.val(i.attr("data-value")),this.$selectedBtn=i},selectNext:function(){if(this.$selectedBtn.length){var t=this._getSelectedBtnIndex()+1;"undefined"!=typeof this.$btns[t]&&this.select(this.$btns[t])}else this.select(this.$btns[this.$btns.length-1])},selectPrev:function(){if(this.$selectedBtn.length){var t=this._getSelectedBtnIndex()-1;"undefined"!=typeof this.$btns[t]&&this.select(this.$btns[t])}else this.select(this.$btns[0])},onMouseDown:function(t){this.select(t.currentTarget)},_getSelectedBtnIndex:function(){return"undefined"!=typeof this.$selectedBtn[0]?t.inArray(this.$selectedBtn[0],this.$btns):-1},onKeyDown:function(t){switch(t.keyCode){case Helper.RIGHT_KEY:Helper.ltr?this.selectNext():this.selectPrev(),t.preventDefault();break;case Helper.LEFT_KEY:Helper.ltr?this.selectPrev():this.selectNext(),t.preventDefault()}},destroy:function(){this.$outerContainer.removeData("pill"),this.base()}})}(jQuery);